<!DOCTYPE html>
<html>
<head>

<script>

var authKey = "enctoken Yp9zDCpx7UzNMKBNicEnHd0K1q5Ubj/f17wer/obnnktE988wfhd885OAB1FQwF0GEQHl+spKGI1fh/7R2S62mw061mPrQ==";


</script



<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
	
::-webkit-scrollbar {
  width: 4px;
}

/* Track */
::-webkit-scrollbar-track {
  box-shadow: inset 0 0 5px white; 
  border-radius: 10px;
}
 
/* Handle */
::-webkit-scrollbar-thumb {
  background: grey; 
  border-radius: 10px;
}

#alertData,#indexData ,#gainersData,#losersData,#holdingData,#watchListData ,.watchlistclass{
  font-family: serif;
  border-collapse: collapse;
  width:100%;
}
.tableContainer{
	max-height: 100vh;
    display: inline;
    overflow: scroll;
    float: left;
	width: 300px;
	margin-bottom: 20px;
	margin-left: 2px;	
}

 .line{
    width: 100%;
    height: 2px;
    background-color: grey;
    margin: 5px;
}

.tableContainer.index {
	width: 200px;	
}  

.tableContainer.holding  {
	width: 300px;	
}  


   
 td,  th {
  border: 1px solid #ddd;
  padding: 3px;
}

 tr:nth-child(even){background-color: #f2f2f2;}
 tr:nth-child(odd){background-color: 'white';}

 tr:hover {background-color: #ddd;max-height:20px;}

 th {
  text-align: left;
  color: white;
}
td{
text-align: right;
}

td:first-child { text-align: left; font-size:14px; color: #2e2e88;}

#indexData #nifty ,#indexData #nifty_ch{
  font-size:14px;
  font-weight:bold;
}

#holdingData #holdQty{
  font-size:11px;
}

#holdingData #holdValue,#holdPL{
  font-size:13px;
  font-weight:bold;
}

#alertData th,#indexData th,#holdingData th ,#watchListData th,.watchlistclass th{
  background-color: #545353;
}
#gainersData th{
  background-color:#96e096; 
}
#losersData th{
  background-color:#e86666;
}


tr.newSymbol{
    border-left: 5px solid red;
}

#stockInfo {
    position: fixed;
    right: 0;
    bottom: 0;
    background-color: #f2f2f2;
    border: 2px solid gray;
    width: 276px;
    height: 900px;
    overflow-x: hidden;
	display:none;
	border-left: 1px solid grey;
}

span.title {
    font-weight: bold;
	font-size: 12px;
	display: inline-block;
    width: 50px;	
}

.last_price {
    font-size:12px;	
	color:gray;
}

span.info {
    font-size: 15px;
    color: gray;
    padding-left: 10px;
    width: 31px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.inforow {
    padding-left: 5px;
	padding-bottom: 5px;
}

.favButton{
	margin-left: 10px;
}
#feed-status{
width: 100%;
    height: 5px;
    box-shadow: rgba(251, 88, 88, 0.2) 0 -1px 7px 1px, inset #b72222 0 -1px 9px, rgba(255, 224, 0, 0.5) 0 2px 12px;
    -webkit-animation: blinkRed 0.5s infinite;
    -moz-animation: blinkRed 0.5s infinite;
    -ms-animation: blinkRed 0.5s infinite;
    -o-animation: blinkRed 0.5s infinite;
    animation: blinkRed 0.5s infinite;
    margin-bottom: 5px;
}
}


@-webkit-keyframes blinkRed {
    from { background-color: #F00; }
    50% { background-color: #A00; box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 7px 1px, inset #441313 0 -1px 9px, rgba(255, 0, 0, 0.5) 0 2px 0;}
    to { background-color: #F00; }
}
@-moz-keyframes blinkRed {
    from { background-color: #F00; }
    50% { background-color: #A00; box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 7px 1px, inset #441313 0 -1px 9px, rgba(255, 0, 0, 0.5) 0 2px 0;}
    to { background-color: #F00; }
}
@-ms-keyframes blinkRed {
    from { background-color: #F00; }
    50% { background-color: #A00; box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 7px 1px, inset #441313 0 -1px 9px, rgba(255, 0, 0, 0.5) 0 2px 0;}
    to { background-color: #F00; }
}
@-o-keyframes blinkRed {
    from { background-color: #F00; }
    50% { background-color: #A00; box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 7px 1px, inset #441313 0 -1px 9px, rgba(255, 0, 0, 0.5) 0 2px 0;}
    to { background-color: #F00; }
}
@keyframes blinkRed {
    from { background-color: #F00; }
    50% { background-color: #A00; box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 7px 1px, inset #441313 0 -1px 9px, rgba(255, 0, 0, 0.5) 0 2px 0;}
    to { background-color: #F00; }
}

#tool-bar{
	position: absolute;
    right: -2px;
    top: 10px;
}

#tool-bar button{
	display: block;
	margin-top: 5px;
}


#graphInfo{
    position: absolute;
    right: 0;
    bottom: 0;
    width: 660px;
    height: 490px;
	transition: width 1s linear;
}

#graphInfo iframe {
	width: 98%;
    height: 100%;
}


.hideTable{
	display:none !important;
}

#portfolioInput{
	width:30px;
}


.symbolSelector{
    position: absolute;
    position: absolute;
    top: 7px;
    right: 5px;
	background-color: #545353;
}

#addRemove{
    height: 24px;

}

#cursor{
	color: red;
	font-size: 15px;
	display: block;
	float: left;
	padding-right: 10px;
	height: 25px;
}

#inputSymbol{
	width: 200px;
    height: 20px;
}

tr {
    height: 30px !important;
}

#stockInfo td {
    width: 60px;
    display: inline-block;
    border: none;
}

.watch_seprater{
    border-left: 4px solid cadetblue;
    padding-left: 5px;
}


#buyOrderView{
	height: 50px;
    padding-top: 20px;
    background-color: #83d495;
}

#sellOrderView{
	background-color: #e68080;;
    height: 50px;
    padding-top: 20px;
	margin-top: 35px;
}


button#buyButton {
    margin-left: 6px;
    width: 48px;
    height: 30px;
    background-color: green;
    color: white;
    font-weight: bold;
}

button#sellButton {
    margin-left: 6px;
    width: 48px;
    height: 30px;
	background-color: red;
    color: white;
    font-weight: bold;	
}

#orderStatusView{
	font-size: 15px;
    font-weight: bold;
}

button.favButton.orderToggleBtn {
    float: right;
}

input{
font-weight: bold;
}

#favcolor{
    display: inline-block;
    position: absolute;
    right: 0;
    top: 0px;
    width:20px;
}

table#historyTable{
width: 90px;
top :25px;
right:0px;
position:absolute;
font-family:cursive;
font-size:10px;
line-height:10px;
}

table#historyTable tr{
 height: 10px !important;
}

table#historyTable > tbody > tr > td:nth-of-type(1) {
width:20px;
}
table#historyTable > tbody > tr > td:nth-of-type(2) {
width:50px;
font-size: 15px;
}


#basket-order{
    right: 300px;
    width: 300px;
    height: 1000px;
    position: absolute;
    background-color: beige;
    top: 140px;
}

    </style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>   
	<div id='feed-status'></div>
	<div id='tool-bar' >
		<br/><br/><br/><br/>
		
		<button type="button" onclick=" resetAllFlag();">BO</button>

		<br/>
		

			
	</div>
	


		
	<div class="tableContainer holding"><table id="holdingData"></table></div>	
	<div class="tableContainer loser"><table id="losersData"></table>	</div>	
	<div class="tableContainer gainers"><table id="gainersData"></table></div>		
	<div class="tableContainer alert hideTable"><table id="alertData"></table></div>		
	<div class="tableContainer alert watch_seprater"><table class="watchlistclass" id="watchListData"></table></div>		
	<div class="tableContainer alert"><table class="watchlistclass"  id="watchListData1"></table></div>	
	<div class="tableContainer alert"><table class="watchlistclass"  id="watchListData2"></table></div>	
	<div class="tableContainer alert"><table class="watchlistclass"  id="watchListData3"></table></div>		
	<div class="tableContainer index"><table id="indexData"></table></div>	
	<div id = "stockInfo" >
		<input onInput="updateKitePerfData();" type="color" id="favcolor" name="favcolor" value="#ff0000">
				
		<table id='historyTable'>
				  <tbody>
		  </tbody>
		</table>	
		
		<div ondblclick="$('#stockInfo').hide();$('#graphInfo').hide();selectedStockInfoData=undefined;" class="infoTable"></div>		
		<div class="line"></div>
		<br/>
		
		<div id="orderView">
			<div id="orderStatusView"></div>
			<br/>
		
			<div id="buyOrderView">
				 
				  <label for="buyQuantity">Q:</label>
				  <input type="number" onClick="this.select();" onInput="updateBuyTextStatus();" id="buyQuantity" step=1 name="buyQuantity" min="1" max="1000" value=1>
				  
				  <label for="buyPrice">P:</label>
				  <input type="number" onClick="this.select();" onInput="updateBuyTextStatus();" id="buyPrice" step=0.2 name="buyPrice" min="1" max="10000" value=0>
				  
				  <button id = 'buyButton' onClick="placeBuyOrder();"> BUY </button>

			</div>

			
			<div id="sellOrderView">
			
				  <label for="sellQuantity">Q:</label>
				  <input type="number"  onClick="this.select();"  onInput="updateSellTextStatus();"  id="sellQuantity" step=1 name="sellQuantity" min="1" max="1000" value=1>
				  
				  <label for="sellPrice">P:</label>
				  <input type="number"  onClick="this.select();"  onInput="updateSellTextStatus();" id="sellPrice" step=0.2 name="sellPrice" min="1" max="10000" value=0>
				  
				  <button id = 'sellButton' onClick="placeSellOrder();"> SELL </button>
			
			</div>				
		</div>
		
		<br/><br/>
		<table id="bidTable">
		  <tbody>
		  </tbody>
		</table>	
	</div>	
		
	


	<div class="symbolSelector">
	
	<button id="addRemove" style="background-color:green" onClick="onToggleButton();" type="button">ADD</button>
	
	<input type='text'  onInput="onInput();" id='inputSymbol' list='inputdlist' />
	<datalist id='inputdlist'>
	</datalist>	
	
	<input type='text'  id='portfolioInput' list='portfolioList' />
	<datalist id='portfolioList'>
		<option value=0>0</option>
		<option value=1>1</option>
		<option value=2>2</option>
		<option value=3>3</option>		
	</datalist>		
	
	<label id="cursor" onClick="$('#cursor').select();" ondblclick="$('#cursor').text('')"></label>	
		
	</div>
	
	
	

</body>

<script>

		var kitePerfData = {};
		if(localStorage.getItem("kitePerfData.json")){
			kitePerfData = JSON.parse(localStorage.getItem("kitePerfData.json"));	
		}


		var orderWindowView = {buyView:true,sellView:true};
		if(localStorage.getItem("orderWindowView.json")){
			orderWindowView = JSON.parse(localStorage.getItem("orderWindowView.json"));	
		}

		registerEnterKeyListiner();
		enableOrderWindow();

		var isLoadCurrentPrice=true;
		var alertTablePick = "alerts";
		var changesJson = new Object(); ;
		var oldChangesJson = new Object(); ;
		var oldPriceMap = new Object(); ;

		function populateOldPriceMap(){
			if(localStorage.getItem("kiteOldChanges.json") != undefined){
				oldChangesJson = JSON.parse(localStorage.getItem("kiteOldChanges.json"));							
				Object.keys(oldChangesJson).forEach(function(key,index) {						
					for(var row in  oldChangesJson[key]){
						oldPriceMap[oldChangesJson[key][row][1]]=oldChangesJson[key][row];
					}				
				});				
			}	
		}

		
		populateOldPriceMap();


		function onToggleButton() {
			var addStatus = 	$('#addRemove').text();
			if(addStatus == 'ADD'){
				$('#addRemove').text('DEL');
				$('#addRemove').css('background-color','red');
			}else{
				$('#addRemove').text('ADD');
				$('#addRemove').css('background-color','green');
			}		
		}

		function onInput() {
			var val = document.getElementById("inputSymbol").value;
			if($('#inputdlist option').filter(function(){
				return this.value.toUpperCase() === val.toUpperCase();        
			}).length) {
				var portfolioId = document.getElementById("portfolioInput").value;
				var isAdd = $('#addRemove').text() == 'ADD'?true:false;
				
				if(['0','1','2','3'].includes(portfolioId) ){
					portfolioId = portfolioId == '0'?"":portfolioId;
					if(isAdd){
						addToFavList(val,portfolioId);						
					}else{
						removeFromFavList(val,portfolioId);						
					}					
				}
				document.getElementById("inputSymbol").select();	
			}		
		}
		  
		function saveCurrentPrice(){
			localStorage.setItem("kiteOldChanges.json", JSON.stringify(changesJson));		
		}

		function loadOldPrice(){	
			if(isLoadCurrentPrice){					
				$('#price-load-btn').text('NP');	
			}else{
				$('#price-load-btn').text('OP');	
				populateOldPriceMap();
			}
			isLoadCurrentPrice = !isLoadCurrentPrice;
		}




		var URLMap = undefined;
		$.getJSON("URLMap.json?v="+(new Date().getTime()), function(obj) {
			URLMap = obj;
		});


		var URLINVMap = undefined;
		$.getJSON("INVURLMap.json?v="+(new Date().getTime()), function(obj) {
			URLINVMap = obj;
		});


		var kiteAllSymbols = undefined;
		$.getJSON("kiteAllSymbols.json?v="+(new Date().getTime()), function(obj) {
			kiteAllSymbols = obj;
			$("#inputdlist").empty();
			$.each(kiteAllSymbols.allSymbols, function(i, item) {
			 if(item.exchange == 'NFO'){
				if(item.name == 'NIFTY' || item.name == 'BANKNIFTY'){
					if(item.segment=='NFO-OPT'){
						var textName = item.name + " " + item.expiry.split(' ')[0] + " " + item.strike +" "+item.instrument_type +" | " + item.expiry.split(' ')[1] +" " + item.expiry.split(' ')[2];
						$("#inputdlist").append($("<option>").attr('value', item.tradingsymbol).text(textName));						
					}else if(item.segment=='NFO-FUT'){
						var textName = item.name + " " + item.expiry.split(' ')[0] + " " + item.expiry.split(' ')[1] +" "+item.instrument_type;
						$("#inputdlist").append($("<option>").attr('value', item.tradingsymbol).text(textName));					
					}
				}	
				
			}else{
				$("#inputdlist").append($("<option>").attr('value', item.tradingsymbol).text(item.name));
			}		
			  
			});
			 $("#inputdlist").append($("<option>").attr('value', 'SEPERATOR').text('SEPERATOR'));				
		});
			

		
        // EXTRACT VALUE FOR HTML HEADER. 
        // ('Book ID', 'Book Name', 'Category' and 'Price')
        var col = ["Name","Chg. %","Last","High","Low","Open"];


        // CREATE DYNAMIC TABLE.
        var alertData = document.getElementById("alertData");
        var watchListData = document.getElementById("watchListData");
		var watchListData1 = document.getElementById("watchListData1");
		var watchListData2 = document.getElementById("watchListData2");
		var watchListData3 = document.getElementById("watchListData3");
		
        var gainersData = document.getElementById("gainersData");
        var losersData = document.getElementById("losersData");
		var indexData = document.getElementById("indexData");
		var holdingData = document.getElementById("holdingData");
		
        // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

        var tr = alertData.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < 3; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        tr = watchListData.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < 3; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        tr = watchListData1.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < 3; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        tr = watchListData2.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < 3; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        tr = watchListData3.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < 3; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }


        tr = gainersData.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < 3; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }
		
		
        tr = losersData.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < 3; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }		
		
        tr = indexData.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < 2; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }
		
        tr = holdingData.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < 2; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }



		
		var dsplayCOl = [0,13,3];	
		var kiteDsplayCOl = ["name","change","lastTradedPrice"];			
		
		setInterval(CreateTableFromJSON, 1500);	
	
	var allSymbols = new Set(); 
	var newSymbolsAdded = new Object(); 
	var priceMap = new Object(); 
	
	var filterSymbols = new Object(); 


	var holdingJSON = new Object(); 
	var positionJSON = new Object(); 
	var kiteJSON = new Object(); 
	


	var jsonFavSymbol = localStorage.getItem("kite_favSymbols");
	var favSymbols = jsonFavSymbol!=undefined ?JSON.parse(jsonFavSymbol):[];
	
	var jsonFavSymbol1 = localStorage.getItem("kite_favSymbols1");
	var favSymbols1 = jsonFavSymbol1!=undefined ?JSON.parse(jsonFavSymbol1):[];
	
	var jsonFavSymbol2 = localStorage.getItem("kite_favSymbols2");
	var favSymbols2 = jsonFavSymbol2!=undefined ?JSON.parse(jsonFavSymbol2):[];
	
	var jsonFavSymbol3 = localStorage.getItem("kite_favSymbols3");
	var favSymbols3 = jsonFavSymbol3!=undefined ?JSON.parse(jsonFavSymbol3):[];
	



    function CreateTableFromJSON() {
		$.getJSON("filter.json?v="+(new Date().getTime()), function(obj) {
			filterSymbols=obj;		
		});
	

		$.getJSON("positions.json?v="+(new Date().getTime()), function(obj) {
			positionJSON=obj;		
		});


		$.getJSON("kiteticks.json?v="+(new Date().getTime()), function(obj) {
			kiteJSON=obj;		
		});

		//update total position
		if(holdingJSON && holdingJSON.data && positionJSON && positionJSON.data){
				var totalHoldQty=0;var totalPositionAddQty=0;var totalPositionSellQty=0;
				for( var i=0;i< holdingJSON.data.length; i++){
					var hobj = holdingJSON.data[i];
					totalHoldQty = totalHoldQty + (hobj.quantity + hobj.t1_quantity);
				}
				
				if(positionJSON.data.net){
					for( var i=0;i< positionJSON.data.net.length; i++){
						var pobj = positionJSON.data.net[i];
						if(pobj.product == 'CNC'){
							if(pobj.quantity > 0){
								totalPositionAddQty = totalPositionAddQty + pobj.quantity;	
							}else{
								totalPositionSellQty = totalPositionSellQty + pobj.quantity;	
							}							
						}					
					}
				}
		}




		$.getJSON("changes.json?v="+(new Date().getTime()), function(obj) {
		
			if(isLoadCurrentPrice){
				changesJson = obj;
			}else{
				obj = oldChangesJson;
			}
			
			var servTime = obj.time;
			var kiteTime = kiteJSON.time;
			var date = new Date();
			var clientTime = date.getHours()*60+date.getMinutes()
			if(Math.abs(clientTime - servTime) > 5 || Math.abs(clientTime - kiteTime) > 5){
				document.getElementById("feed-status").style.display = "block";
			}else{
				document.getElementById("feed-status").style.display = "none"
			}
			
/*
			for(var row in  obj.index){
				if(!allSymbols.has(obj.index[row][1])){
					newSymbolsAdded[obj.index[row][1]]=clientTime;
				}
				allSymbols.add(obj.index[row][1]);
				priceMap[obj.index[row][1]]=obj.index[row];
			}			
			for(var row in  obj.alerts){
				if(!allSymbols.has(obj.alerts[row][1])){
					newSymbolsAdded[obj.alerts[row][1]]=clientTime;
				}
				allSymbols.add(obj.alerts[row][1]);
				priceMap[obj.alerts[row][1]]=obj.alerts[row];
			}
			for(var row in obj.gainers){
				if(!allSymbols.has(obj.gainers[row][1])){
					newSymbolsAdded[obj.gainers[row][1]]=clientTime;
				}
				allSymbols.add(obj.gainers[row][1]);
				priceMap[obj.gainers[row][1]]=obj.gainers[row];
			}
			for(var row in obj.losers){
				if(!allSymbols.has(obj.losers[row][1])){
					newSymbolsAdded[obj.losers[row][1]]=clientTime;
				}
				allSymbols.add(obj.losers[row][1]);
				priceMap[obj.losers[row][1]]=obj.losers[row];
			}			
			for(var row in obj.topPicks){
				if(!allSymbols.has(obj.topPicks[row][1])){
					newSymbolsAdded[obj.topPicks[row][1]]=clientTime;
				}
				allSymbols.add(obj.topPicks[row][1]);
				priceMap[obj.topPicks[row][1]]=obj.topPicks[row];
			}				
			for(var row in obj.itPicks){
				if(!allSymbols.has(obj.itPicks[row][1])){
					newSymbolsAdded[obj.itPicks[row][1]]=clientTime;
				}
				allSymbols.add(obj.itPicks[row][1]);
				priceMap[obj.itPicks[row][1]]=obj.itPicks[row];
			}				
			for(var row in obj.resultsPicks){
				if(!allSymbols.has(obj.resultsPicks[row][1])){
					newSymbolsAdded[obj.resultsPicks[row][1]]=clientTime;
				}
				allSymbols.add(obj.resultsPicks[row][1]);
				priceMap[obj.resultsPicks[row][1]]=obj.resultsPicks[row];
			}	
			for (var key in newSymbolsAdded) {
				if (newSymbolsAdded.hasOwnProperty(key)) {
					//Now, object[key] is the current value
					if (clientTime - newSymbolsAdded[key] > 10)
						delete newSymbolsAdded[key];
			}	}

			for(var row in obj.allSymbols){
				priceMap[obj.allSymbols[row][1]]=obj.allSymbols[row];
			}	
			

			
			var alertObj = obj.alerts;
			if(alertTablePick == 'top'){			
				alertObj = obj.topPicks;
			}else if(alertTablePick == 'it'){
				alertObj = obj.itPicks;
			}else if(alertTablePick == 'result'){
				alertObj = obj.resultsPicks;
			}else if(alertTablePick == 'pharma'){
				alertObj = obj.pharmaPicks;
			}else if(alertTablePick == 'fmcg'){
				alertObj = obj.fmcgPicks;
			}
			$("#alertData").find("tr:not(:first)").remove();		 
			// ADD JSON DATA TO THE TABLE AS ROWS.
			for (var i = alertObj.length -1; i >=0 ; i--) {
				if(filterSymbols[alertObj[i][1]])continue;
			
				tr = alertData.insertRow(-1);	
				tr.onclick=onRowClick;	
				tr.rowid=alertObj[i][1];					
				for (var j in dsplayCOl) {
					var tabCell = tr.insertCell(-1);
					if(dsplayCOl[j] == 13){
						var cellV =  alertObj[i][dsplayCOl[j]];					
						var change = Number(cellV.split(".")[0]);

						if(cellV.startsWith("-")){
							if(change < -2.5){
								tabCell.style.color='red';
							}else{
								tabCell.style.color='#f18d8d';
							}
						}else{
							if(change > 2.5){
								tabCell.style.color='green';
							}else{
								tabCell.style.color='#b6e0b6';
							}					
						
						}
					}
					tabCell.innerHTML = alertObj[i][dsplayCOl[j]];
					
					if(j==0 && newSymbolsAdded[alertObj[i][1]]!=undefined){
						tr.classList.add("newSymbol");
					}
				}
			}	
			
*/
		
			var indexObj = obj.index;
				
			$("#indexData").find("tr:not(:first)").remove();		 
			// ADD JSON DATA TO THE TABLE AS ROWS.
			for (var i = 0; i < indexObj.length; i++) {
				tr = indexData.insertRow(-1);		
			//	tr.onclick=onRowClick;		
				tr.rowid=indexObj[i][1];	
				for (var j in dsplayCOl) {
					if( j < 2){
						var tabCell = tr.insertCell(-1);
						if(dsplayCOl[j] == 13){
							var cellV =  indexObj[i][dsplayCOl[j]];					
							if(cellV.startsWith("-")){
								tabCell.style.color='red';
							}else{
								tabCell.style.color='green';
							}
						}
						
						if(i==0 && j==0){
							tabCell.innerHTML = indexObj[i][dsplayCOl[j]] + "<br/><span id='nifty'>  (" + indexObj[i][dsplayCOl[2]] +") </span>"     ;
						}else if(i==0 && j==1){
							tabCell.innerHTML = indexObj[i][dsplayCOl[j]] + "<br/><span id='nifty_ch'>  (" + indexObj[i][12] +") </span>"  
						}else{
							tabCell.innerHTML = indexObj[i][dsplayCOl[j]];
						}
					}
				}
			}				
			
			
			var tempSortedTicks = Object.keys(kiteJSON.ticks);
			var sortedTicks = [];
			for(var i=0;i<tempSortedTicks.length;i++){
				if(kiteJSON.ticks[tempSortedTicks[i]].exchange == 'NFO') continue;
				sortedTicks.push(tempSortedTicks[i]);
			}			
			sortedTicks.sort(function(t1, t2){return kiteJSON.ticks[t2].change - kiteJSON.ticks[t1].change});
			
			
			var gainersObj = obj.gainers;
			$("#gainersData").find("tr:not(:first)").remove();		 
			// ADD JSON DATA TO THE TABLE AS ROWS.
			for (var i = 0; i < sortedTicks.length; i++) {
				if(filterSymbols[sortedTicks[i]]  )continue;
				if(kiteJSON.ticks[sortedTicks[i]].change < 2)break;
				tr = gainersData.insertRow(-1);		
				tr.onclick=onRowClick.bind({rowid:sortedTicks[i]});			
				tr.rowid=sortedTicks[i];				
				for (var j in kiteDsplayCOl ) {										
					if( j < 3){
						var tabCell = tr.insertCell(-1);
						if(kiteDsplayCOl[j] == "change"){
							var cellV =  (kiteJSON.ticks[sortedTicks[i]][kiteDsplayCOl[j]]).toFixed(2);					
							if(cellV <0){
								tabCell.style.color='red';
							}else{
								tabCell.style.color='green';
							}
							tabCell.innerHTML =cellV;
						}else if(kiteDsplayCOl[j] == "name"){
							tabCell.innerHTML = kiteJSON.ticks[sortedTicks[i]][kiteDsplayCOl[j]]==undefined?sortedTicks[i]:kiteJSON.ticks[sortedTicks[i]][kiteDsplayCOl[j]];								
						}else{
							tabCell.innerHTML = kiteJSON.ticks[sortedTicks[i]][kiteDsplayCOl[j]];	
						}	
					}
				}
			}				
			
			
			var losersObj = obj.losers;
			$("#losersData").find("tr:not(:first)").remove();		 
			// ADD JSON DATA TO THE TABLE AS ROWS.
			for (var i = sortedTicks.length-1; i >= 0; i--) {
				if(filterSymbols[sortedTicks[i]])continue;
				if(kiteJSON.ticks[sortedTicks[i]].change > -2)break;
				tr = losersData.insertRow(-1);	
				tr.onclick=onRowClick.bind({rowid:sortedTicks[i]})	;	
				tr.rowid=sortedTicks[i];				
				for (var j in kiteDsplayCOl ) {										
					if( j < 3){
						var tabCell = tr.insertCell(-1);
						if(kiteDsplayCOl[j] == "change"){
							var cellV =  (kiteJSON.ticks[sortedTicks[i]][kiteDsplayCOl[j]]).toFixed(2);					
							if(cellV <0){
								tabCell.style.color='red';
							}else{
								tabCell.style.color='green';
							}
							tabCell.innerHTML =cellV;
						}else if(kiteDsplayCOl[j] == "name"){
							tabCell.innerHTML = kiteJSON.ticks[sortedTicks[i]][kiteDsplayCOl[j]]==undefined?sortedTicks[i]:kiteJSON.ticks[sortedTicks[i]][kiteDsplayCOl[j]];								
						}else{
							tabCell.innerHTML = kiteJSON.ticks[sortedTicks[i]][kiteDsplayCOl[j]];								
						}		
						
						 if(kitePerfData[tr.rowid] && kiteDsplayCOl[j] == "name"){
							 tabCell.style['background-color']=kitePerfData[tr.rowid].color;
						 }
						
					}
				}
			}		



			
			$("#watchListData").find("tr:not(:first)").remove();		 
			// ADD JSON DATA TO THE TABLE AS ROWS.
			for (var i = 0; i < favSymbols.length; i++) {	
				if(favSymbols[i] == 'SEPERATOR'){
					addSeprator(watchListData);
					continue;
				}			
				if(kiteJSON.ticks[favSymbols[i]] !=undefined){
					tr = watchListData.insertRow(-1);	
					tr.onclick=onRowClick.bind({rowid:favSymbols[i],portfolioId:0});		
					tr.ondblclick= updateInsertPosition.bind({rowid:favSymbols[i],portfolioId:0}) ;	
					tr.rowid=favSymbols[i];		


					for (var j in kiteDsplayCOl ) {
						if( j < 3){
							var tabCell = tr.insertCell(-1);
							if(kiteDsplayCOl[j] == "change"){
								var cellV =  (kiteJSON.ticks[favSymbols[i]][kiteDsplayCOl[j]]).toFixed(2);					
								if(cellV <0){
									tabCell.style.color='red';
								}else{
									tabCell.style.color='green';
								}
								tabCell.innerHTML =cellV;
							}else{
								tabCell.innerHTML = kiteJSON.ticks[favSymbols[i]][kiteDsplayCOl[j]];								
							}	
							
							 if(kitePerfData[tr.rowid] && kiteDsplayCOl[j] == "name"){
								 tabCell.style['background-color']=kitePerfData[tr.rowid].color;
							 }
						}
					}
				}
			}



			
			$("#watchListData1").find("tr:not(:first)").remove();		 
			// ADD JSON DATA TO THE TABLE AS ROWS.
			for (var i = 0; i < favSymbols1.length; i++) {	
				if(favSymbols1[i] == 'SEPERATOR'){
					addSeprator(watchListData1);
					continue;
				}			
				if(kiteJSON.ticks[favSymbols1[i]] !=undefined){
					tr = watchListData1.insertRow(-1);	
					tr.onclick=onRowClick.bind({rowid:favSymbols1[i],portfolioId:1})		
					tr.ondblclick= updateInsertPosition.bind({rowid:favSymbols1[i],portfolioId:1}) ;	
					tr.rowid=favSymbols1[i];		


					for (var j in kiteDsplayCOl ) {
						if( j < 3){
							var tabCell = tr.insertCell(-1);
							if(kiteDsplayCOl[j] == "change"){
								var cellV =  (kiteJSON.ticks[favSymbols1[i]][kiteDsplayCOl[j]]).toFixed(2);					
								if(cellV <0){
									tabCell.style.color='red';
								}else{
									tabCell.style.color='green';
								}
								tabCell.innerHTML =cellV;
							}else{
								tabCell.innerHTML = kiteJSON.ticks[favSymbols1[i]][kiteDsplayCOl[j]];								
							}	
							
							 if(kitePerfData[tr.rowid] && kiteDsplayCOl[j] == "name"){
								 tabCell.style['background-color']=kitePerfData[tr.rowid].color;
							 }
						}
					}
				}
			}



			
			$("#watchListData2").find("tr:not(:first)").remove();		 
			// ADD JSON DATA TO THE TABLE AS ROWS.
			for (var i = 0; i < favSymbols2.length; i++) {	
				if(favSymbols2[i] == 'SEPERATOR'){
					addSeprator(watchListData2);
					continue;
				}			
				if(kiteJSON.ticks[favSymbols2[i]] !=undefined){
					tr = watchListData2.insertRow(-1);	
					tr.onclick=onRowClick.bind({rowid:favSymbols2[i],portfolioId:2}) ;			
					tr.ondblclick= updateInsertPosition.bind({rowid:favSymbols2[i],portfolioId:2}) ;	
					tr.rowid=favSymbols2[i];		


					for (var j in kiteDsplayCOl ) {
						if( j < 3){
							var tabCell = tr.insertCell(-1);
							if(kiteDsplayCOl[j] == "change"){
								var cellV =  (kiteJSON.ticks[favSymbols2[i]][kiteDsplayCOl[j]]).toFixed(2);					
								if(cellV <0){
									tabCell.style.color='red';
								}else{
									tabCell.style.color='green';
								}
								tabCell.innerHTML =cellV;
							}else{
								tabCell.innerHTML = kiteJSON.ticks[favSymbols2[i]][kiteDsplayCOl[j]];								
							}	
							 if(kitePerfData[tr.rowid] && kiteDsplayCOl[j] == "name"){
								 tabCell.style['background-color']=kitePerfData[tr.rowid].color;
							 }
						}
					}
				}
			}
		
			
			
			
			$("#watchListData3").find("tr:not(:first)").remove();		 
			// ADD JSON DATA TO THE TABLE AS ROWS.
			for (var i = 0; i < favSymbols3.length; i++) {	
				if(favSymbols3[i] == 'SEPERATOR'){
					addSeprator(watchListData3);
					continue;
				}			
				if(kiteJSON.ticks[favSymbols3[i]] !=undefined){
					tr = watchListData3.insertRow(-1);	
					tr.onclick=onRowClick.bind({rowid:favSymbols3[i],portfolioId:3}); 	
					tr.ondblclick= updateInsertPosition.bind({rowid:favSymbols3[i],portfolioId:3}) ;	
					tr.rowid=favSymbols3[i];		


					for (var j in kiteDsplayCOl ) {
						if( j < 3){
							var tabCell = tr.insertCell(-1);
							if(kiteDsplayCOl[j] == "change"){
								var cellV =  (kiteJSON.ticks[favSymbols3[i]][kiteDsplayCOl[j]]).toFixed(2);					
								if(cellV <0){
									tabCell.style.color='red';
								}else{
									tabCell.style.color='green';
								}
								tabCell.innerHTML =cellV;
							}else{
								tabCell.innerHTML = kiteJSON.ticks[favSymbols3[i]][kiteDsplayCOl[j]];								
							}	
							 if(kitePerfData[tr.rowid] && kiteDsplayCOl[j] == "name"){
								 tabCell.style['background-color']=kitePerfData[tr.rowid].color;
							 }
						}
					}
				}
			}







		if(selectedStockInfoData !=undefined){
			var bindoNlcikStrockInfoCall = onRowClick.bind(selectedStockInfoData);
			bindoNlcikStrockInfoCall();			
		}

	/*
			$("tr:not(:first)").mouseover(function(evt){
				if(window.timeoutId){window.clearTimeout(window.timeoutId)}
				window.timeoutId = window.setTimeout(onRowClick, 500,evt)
				}						
			);
			$("tr:not(:first)").mouseout(function(){ if(window.timeoutId){window.clearTimeout(window.timeoutId)}});
	*/	
			
		});        
		
		
		
		
		
		$.getJSON("holdings.json?v="+(new Date().getTime()), function(obj) {
			holdingJSON = obj;

			var PL =0;
			var currentValue=0;
			var totalInvestment=0;
			$("#holdingData").find("tr:not(:first)").remove();	
			if(obj.data){
				obj.data.sort(function(a, b){return a.day_change_percentage-b.day_change_percentage})
				tr = holdingData.insertRow(-1);	
				var sumCell = tr.insertCell(-1);
				sumCell.colSpan ="2";
				

				tr = holdingData.insertRow(-1);	
				var positionCell = tr.insertCell(-1);
				positionCell.colSpan ="2";
				positionCell.innerHTML ="<span>"+totalHoldQty+"&nbsp;|"+ totalPositionAddQty +"&nbsp;|"+totalPositionSellQty+"&nbsp;&nbsp;=&nbsp;"+(totalHoldQty+totalPositionAddQty)+"</span>"

				for( var i=0;i< obj.data.length; i++){
					trade = obj.data[i];
					currentValue = currentValue + (trade.quantity + trade.t1_quantity)*trade.last_price;
					totalInvestment = totalInvestment + (trade.quantity + trade.t1_quantity)*trade.average_price;
					var profit = 	(trade.quantity + trade.t1_quantity)*trade.last_price - (trade.quantity + trade.t1_quantity)*trade.average_price;
					
					tr = holdingData.insertRow(-1);	
					var tabCell = tr.insertCell(-1);
					tabCell.innerHTML  = trade.tradingsymbol + "<span id='holdQty'>  (" + (trade.quantity + trade.t1_quantity) +") </span>" + "&nbsp;<span id='holdValue'>  (" + Math.round((trade.quantity + trade.t1_quantity)*trade.last_price/1000) +") </span>";
										
					tabCell = tr.insertCell(-1);
					
					var cellValue = "";
					if(trade.day_change_percentage > 0){
						cellValue += "<span class='last_price'>" + trade.last_price.toFixed(2) +" </span>&nbsp;&nbsp;<span id='holdDayChg' style='color:green;font-size:16px;'>  " + trade.day_change_percentage.toFixed(2) +" </span>" ;
					}else if(trade.day_change_percentage < -2){
						cellValue += "<span class='last_price'>" + trade.last_price.toFixed(2) +" </span>&nbsp;&nbsp;<span id='holdDayChg' style='color:red;font-size:16px;font-weight:bold;'>  " + trade.day_change_percentage.toFixed(2) +"</span>" ;
					}else{
						cellValue += "<span class='last_price'>" + trade.last_price.toFixed(2) +" </span>&nbsp;&nbsp;<span id='holdDayChg' style='color:red;font-size:16px;'>  " + trade.day_change_percentage.toFixed(2) +" </span>" ;
					}
					
					if(profit > 0){
						cellValue +=   "<br/><span id='holdPL' style='color:green;font-size:11px;'>  " +Math.round(profit) +"</span>&nbsp;&nbsp;<span style='color:green;font-size:13px;'>(" + (profit*100/((trade.quantity + trade.t1_quantity)*trade.average_price)).toFixed(2) +"%) </span>" 
					}else{
						cellValue +=   "<br/><span id='holdPL' style='color:red;font-size:11px;'>  " + Math.round(profit) +"</span>&nbsp;&nbsp;<span style='color:red;font-size:13px;'>("+ (profit*100/((trade.quantity + trade.t1_quantity)*trade.average_price)).toFixed(2) +"%) </span>" 
					}
					
					tabCell.innerHTML = cellValue;
					tabCell.style.textAlign="right";
					
				}			
				PL = Math.round(currentValue - totalInvestment);
				if(PL > 0){
					sumCell.innerHTML = "<span id='totalValue'>"+(currentValue/100000).toFixed(2)+"L&nbsp;&nbsp;&nbsp;</span><span id='TPL' style='color:green;'>"+Math.round(PL)+" ( "+(PL*100/totalInvestment).toFixed(2)+"%)</span>"; 
				}else{
					sumCell.innerHTML = "<span id='totalValue'>"+currentValue+"</span><span id='TPL' style='color:red;'>"+Math.round(PL)+" ( "+(PL*100/totalInvestment).toFixed(2)+"%) </span>"; 
				}
				sumCell.style.fontSize="20px";
				sumCell.style.textAlign="center";
				sumCell.style.fontWeight="bold";
				sumCell.style.backgroundColor="white";
				sumCell.style.boxShadow= "5px 5px 5px #888";
				document.title=Math.round(PL/1000) +"K ( "+(PL*100/totalInvestment).toFixed(2)+"%) ";
			}
			
						
			
		}); 		
	
    }
	
	function addSeprator(tempTeble){
		var tr = tempTeble.insertRow(-1);			
		//var tabCell = tr.insertCell(-1);	
		tr.style.height='30px';	
	}
	
	
	function updateInsertPosition(rowid,portfolioId){
		$('#cursor').text(this.rowid);		
		$('#portfolioInput')[0].value=this.portfolioId;
	//	$('#portfolioInput').attr('value','ADD-'+this.portfolioId);	
	}
	


	var detailColum =["Name","Symbol","Exchange","Last","Bid","Ask","Extended Hours","Extended Hours (%)","Open","Prev.","High","Low","Chg.","Chg. %","Vol.","Next Earnings Date","Time","Market Cap","Revenue","Average Vol. (3m)","EPS","P/E Ratio","Beta","Dividend","Yield","5 Minutes","15 Minutes","30 Minutes","Hourly","5 Hours","Daily","Weekly","Monthly","Daily","1 Week","1 Month","YTD","1 Year","3 Years"];
	
	var selectedStockInfoData;
	
	function onRowClick(evt){
		var rowid= this.rowid;
		var portfolioId= this.portfolioId;
		selectedStockInfoData = {rowid:rowid,portfolioId:portfolioId};
	
		if(evt != undefined){
			$("#historyTable tbody").empty();
			getHistoricaldata(kiteJSON.ticks[rowid]);
		}
		
		$("#stockInfo .infoTable").empty();
		$("#bidTable tbody").empty();		
		$("#stockInfo").show();
	//	$("#graphInfo").show();
		
		if(kiteJSON.ticks[rowid] != undefined){
			
			
		
			var hrefGraph = 'https://kite.zerodha.com/chart/ext/tvc/NSE/'+kiteJSON.ticks[rowid].tradingsymbol+'/'+kiteJSON.ticks[rowid].token
					
			$("#stockInfo .infoTable").append( "<div class='inforow'><span >"+kiteJSON.ticks[rowid].name+": </span>    <span><a rel='noreferrer' target='_blank' href='"+hrefGraph+"'>"+kiteJSON.ticks[rowid].tradingsymbol+"</a></span>  </div>" );
	//		$("#stockInfo .infoTable").append( "<div class='inforow'><span class='title'>symbol:</span><span><a rel='noreferrer' target='_blank' href='"+hrefGraph+"'>"+kiteJSON.ticks[rowid].tradingsymbol+"</a></span></div>" );
			$("#stockInfo .infoTable").append( "<div class='inforow'><span class='title'>LTP:</span><span class='info'>"+kiteJSON.ticks[rowid].lastTradedPrice+"</span></div>" );
			$("#stockInfo .infoTable").append( "<div class='inforow'><span class='title'>Change:</span><span class='info'>"+(kiteJSON.ticks[rowid].change).toFixed(2)+"%</span></div>" );			
			$("#stockInfo .infoTable").append( "<div class='inforow'><span class='title'>Volume:</span><span class='info'>"+kiteJSON.ticks[rowid].volumeTradedToday+"</span></div>" );
			$("#stockInfo .infoTable").append( "<div class='inforow'><span class='title'>Open:</span><span class='info'>"+kiteJSON.ticks[rowid].openPrice+"</span></div>" );
			$("#stockInfo .infoTable").append( "<div class='inforow'><span class='title'>Close:</span><span class='info'>"+kiteJSON.ticks[rowid].closePrice+"</span></div>" );			
			$("#stockInfo .infoTable").append( "<div class='inforow'><span class='title'>High:</span><span class='info'>"+kiteJSON.ticks[rowid].highPrice+"</span></div>" );
			$("#stockInfo .infoTable").append( "<div class='inforow'><span class='title'>Low:</span><span class='info'>"+kiteJSON.ticks[rowid].lowPrice+"</span></div>" );

			var tickTime = kiteJSON.ticks[rowid].tickTimestamp?kiteJSON.ticks[rowid].tickTimestamp:kiteJSON.ticks[rowid].lastTradedTime;
			$("#stockInfo .infoTable").append( "<div class='inforow'><span class='title'>Time:</span><span class='info'>"+tickTime.split(' ')[3]+"</span></div>" );


			$("#stockInfo .infoTable").append('<br/><br/>');
	//		$("#stockInfo .infoTable").append('<div class="line"></div>');		
			$("#stockInfo .infoTable").append('<button class="favButton"  style="color:green" onclick="addToFavList(\''+rowid+'\')" type="button">A 0</button>');
			if(portfolioId != undefined){
				switch(portfolioId){
					case 0:
						$("#stockInfo .infoTable").append('<button class="favButton" style="color:red" onclick="removeFromFavList(\''+rowid+'\')" type="button">R 0</button>');
						break;
					case 1:
						$("#stockInfo .infoTable").append('<button class="favButton" style="color:red" onclick="removeFromFavList(\''+rowid+'\',1)" type="button">R 1</button>');
						break;
					case 2:
						$("#stockInfo .infoTable").append('<button class="favButton"  style="color:red" onclick="removeFromFavList(\''+rowid+'\',2)" type="button">R 2</button>');
						break;
					case 3:
						$("#stockInfo .infoTable").append('<button class="favButton"  style="color:red" onclick="removeFromFavList(\''+rowid+'\',3)" type="button">R 3</button>');
						break;
					default:
						break					
				}
			}			
			
			
			
			$("#stockInfo .infoTable").append('<button class="favButton orderToggleBtn"  onclick="toogleSellView()" type="button">SW</button>');
			$("#stockInfo .infoTable").append('<button class="favButton orderToggleBtn"  onclick="toogleBuyView()" type="button">BW</button>');
			
			if(evt != undefined){
				$('#orderStatusView').text(kiteJSON.ticks[rowid].exchange +"::"+ evt.target.parentNode.rowid );
				$('#orderStatusView').attr('tradingsymbol',kiteJSON.ticks[rowid].exchange +"::"+evt.target.parentNode.rowid);				
			}
			
		//	$("#stockInfo .infoTable").append('<div class="line"></div><br/>');
			var depth = kiteJSON.ticks[rowid].depth;
			if(depth && depth.buy.length == 5 &&  depth.sell.length==5){
				for(var i=0;i<5;i++){
					$("#bidTable tbody").append('<tr><td style="color:blue">'+depth.buy[i].price+'</td><td style="color:blue">'+depth.buy[i].quantity+'</td><td style="color:red">'+depth.sell[i].price+'</td><td style="color:red">'+depth.sell[i].quantity+'</td></tr>');
				}		
				$("#bidTable tbody").append('<tr></tr>');
				$("#bidTable tbody").append('<tr><td colspan="2" style="color:blue">'+kiteJSON.ticks[rowid].totalBuyQuantity+'</td><td></td><td colspan="2" style="color:red">'+kiteJSON.ticks[rowid].totalSellQuantity+'</td><td></td></tr>');				
				
				if(evt != undefined){
					
					
					$('#buyPrice')[0].value=depth.buy[0].price;
					$('#sellPrice')[0].value=depth.sell[0].price;		
					
					$('#buyQuantity')[0].value=1;
					$('#sellQuantity')[0].value=1;			

					if(orderWindowView && orderWindowView.buyView == true){
						$('#buyQuantity').focus();$('#buyQuantity').select();
					}else if(orderWindowView && orderWindowView.sellView == true){
						$('#sellQuantity').focus();$('#sellQuantity').select();
					}
										
				}	
								
			}

		}
	}
	
	
	$('#graphInfo').hover(function(){
	  $('#graphInfo').css("width", "1730px");	  
	  if(window.timeoutId2){window.clearTimeout(window.timeoutId2)}				
	})

	$('#graphInfo').mouseout(function(){
		if(window.timeoutId2){window.clearTimeout(window.timeoutId2)};	
		window.timeoutId2 = window.setTimeout(function(){$('#graphInfo').css("width", "660px");}, 1000);		  
	})	


	function getFavSymbols(listId){
		switch(listId){
			case "1": return favSymbols1;
			case "2": return favSymbols2;
			case "3": return favSymbols3;
			default:return favSymbols;		
		}
	}

	function setFavSymbols(listId,tempSymbols){
		switch(listId){
			case "1":  favSymbols1=tempSymbols;break;
			case "2":  favSymbols2=tempSymbols;break;
			case "3":  favSymbols3=tempSymbols;break;
			default: favSymbols=tempSymbols;		
		}
	}

	function addToFavList(data,listId){
		
		listId = listId==undefined?"":listId+"";
		var tempSymbols = getFavSymbols(listId);
	
		if(data != 'SEPERATOR'){
			tempSymbols = tempSymbols.filter(function(value, index){
				return value != data;
			});		
		}

		if(data == 'SEPERATOR' || kiteJSON.ticks[data]){
			var cursorRowId = $('#cursor').text();	
			var indertPos = tempSymbols.indexOf(cursorRowId);
			if(indertPos >= 0){
				tempSymbols.splice(indertPos, 0, data);
			}else{
				tempSymbols.unshift(data);
			}


			setFavSymbols(listId,tempSymbols);
			localStorage.setItem("kite_favSymbols"+listId, JSON.stringify(tempSymbols));		
		}

		
		
		if(data != 'SEPERATOR' && !kiteJSON.ticks[data]){
			console.error(data);
		}
		
	}


	
	
	
	
	function updateKitePerfData(){		
		
		var coloValue = $('#favcolor')[0].value;
		var tradingSymbol = $('#orderStatusView').attr('tradingsymbol').split('::')[1];
		if( kitePerfData[tradingSymbol] == undefined){
			 kitePerfData[tradingSymbol] = {};
		}
		kitePerfData[tradingSymbol].color=coloValue;
		localStorage.setItem("kitePerfData.json", JSON.stringify(kitePerfData));
		$('#favcolor')[0].value='#000000';
	}
	
	function removeFromFavList(data,listId){		
		listId = listId==undefined?"":listId+"";
		var tempSymbols = getFavSymbols(listId);
		
		if(data != 'SEPERATOR'){
			tempSymbols = tempSymbols.filter(function(value, index){
				return value != data;
			});
		}else{
			var cursorRowId = $('#cursor').text();	
			var deletePos = tempSymbols.indexOf(cursorRowId);
			tempSymbols.splice(deletePos+1,1)
			
		}			
		setFavSymbols(listId,tempSymbols);
		localStorage.setItem("kite_favSymbols"+listId, JSON.stringify(tempSymbols));
	}
	
	
	
	function toogleBuyView(){
		orderWindowView.buyView = !orderWindowView.buyView;
		enableOrderWindow();	
	}
	
	function toogleSellView(){
		orderWindowView.sellView = !orderWindowView.sellView;
		enableOrderWindow();
	}
	
	

	
	
	function enableOrderWindow(){
		
		if(orderWindowView.buyView == true){
			$('#buyOrderView').show();
		}else{
			$('#buyOrderView').hide();
		}
		
		if(orderWindowView.sellView == true){
			$('#sellOrderView').show();
		}else{
			$('#sellOrderView').hide();
		}		
	    
		localStorage.setItem("orderWindowView.json", JSON.stringify(orderWindowView));			
	}	
	

	function registerEnterKeyListiner(){
	
		var buyOrderView = document.getElementById("buyOrderView");
		buyOrderView.addEventListener("keyup", function(event) {
		  if (event.keyCode === 13) {
		   event.preventDefault();
		   document.getElementById("buyButton").click();
		  }
		});

		var sellOrderView = document.getElementById("sellOrderView");
		sellOrderView.addEventListener("keyup", function(event) {
		  if (event.keyCode === 13) {
		   event.preventDefault();
		   document.getElementById("sellButton").click();
		  }
		});
		

	  $(document).on('keydown', function(event) {
		   if (event.key == "Escape") {
			  $('#stockInfo').hide();selectedStockInfoData=undefined;
		   }
	   });		
		
		
	}	
	
	

	
	
	function placeBuyOrder(){
		var qty = $('#buyQuantity')[0].value
		var price = $('#buyPrice')[0].value;
		var tradingSymbol = $('#orderStatusView').attr('tradingsymbol');
		
		var orderData = {tradingSymbol:tradingSymbol,transaction_type:'BUY',order_type:'LIMIT',quantity:qty,price:price};
		placeOrder(orderData);
		
		$('#buyQuantity')[0].value=1;
		$('#buyPrice')[0].value=0;
	}
	
	
	function placeSellOrder(){
		var qty = $('#sellQuantity')[0].value;
		var price = $('#sellPrice')[0].value;
		var tradingSymbol = $('#orderStatusView').attr('tradingsymbol');
	
		var orderData = {tradingSymbol:tradingSymbol,transaction_type:'SELL',order_type:'LIMIT',quantity:qty,price:price};
		placeOrder(orderData);
		
		$('#sellQuantity')[0].value=1;
		$('#sellPrice')[0].value=0;		
	}
	
	
	function updateBuyTextStatus(){
		var tradingSymbol = $('#orderStatusView').attr('tradingsymbol');
		var qty = $('#buyQuantity')[0].value
		var price = $('#buyPrice')[0].value;
		
		$('#orderStatusView').html(tradingSymbol +"&nbsp;&nbsp;Q->"+qty+"&nbsp;&nbsp;P->"+price);
		$('#orderStatusView').css('color','green');
	}	
	
	function updateSellTextStatus(){
		var qty = $('#sellQuantity')[0].value;
		var price = $('#sellPrice')[0].value;	
		var tradingSymbol = $('#orderStatusView').attr('tradingsymbol');
		$('#orderStatusView').html(tradingSymbol +"&nbsp;&nbsp;Q->"+qty+"&nbsp;&nbsp;P->"+price);
		$('#orderStatusView').css('color','red');
		
	}
	
	function updateStatus(orderData){
					
		$('#orderStatusView').text(orderData.tradingSymbol +' -> '+ orderData.transaction_type +' -> '+ orderData.order_type +'        Q: '+orderData.quantity + '   P: '+orderData.price); // show in color for buy/sell
	
		if(orderData.transaction_type == 'SELL'){
			$('#orderStatusView').css('color','red');
		}else{
			$('#orderStatusView').css('color','green');
		}
	
	}
	
	
	
	function placeOrder(orderData){
		updateStatus(orderData);	
		
								
		$.ajax({
			url: 'https://kite.zerodha.com/oms/orders/regular',
			type: 'post',
		data:{exchange:orderData.tradingSymbol.split('::')[0],tradingsymbol:orderData.tradingSymbol.split('::')[1],transaction_type:orderData.transaction_type,order_type:orderData.order_type,quantity:Number(orderData.quantity),price:Number(orderData.price),product:'CNC',validity:'DAY',disclosed_quantity:0,trigger_price:0,squareoff:0,stoploss:0,trailing_stoploss:0,variety:'regular',user_id:"DA6170"},
			headers: {
				"Content-Type": "application/x-www-form-urlencoded",
				"authorization": authKey
			},
			dataType: 'json',
			success: function (data) {
				console.info(data);
				$('#orderStatusView').text("SUCCESS : "+data.data.order_id);
			},
			error:function (data) {
				console.info(data);
				$('#orderStatusView').text(data.responseJSON.message);
			}
		});			
	}
		
	
	
	function getHistoricaldata(ticker){
		 var fromdate = new Date();
		 fromdate.setDate(fromdate.getDate()-2000);
		 
		$.ajax({
			url: 'https://api.kite.trade/instruments/historical/'+ticker.token+'/day?from='+fromdate.toISOString().split('T')[0]+'&to='+new Date().toISOString().split('T')[0],
			type: 'get',
			headers: {
				"X-Kite-Version":"3",
				"Content-Type": "application/x-www-form-urlencoded",
				"authorization": authKey
			},
			dataType: 'json',
			success: function (data) {
				data= data.data.candles;
				var totalTick = data.length-1;
				var close = data[totalTick][4];
				$("#historyTable tbody").empty();
				
				$("#historyTable tbody").append('<tr> <td>1d</td> <td>'+Number.parseInt(-(data[totalTick-1][4]-close)*100/data[totalTick-1][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>2d</td> <td>'+Number.parseInt(-(data[totalTick-2][4]-close)*100/data[totalTick-2][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>3d</td> <td>'+Number.parseInt(-(data[totalTick-3][4]-close)*100/data[totalTick-3][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>1w</td> <td>'+Number.parseInt(-(data[totalTick-5][4]-close)*100/data[totalTick-5][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>2w</td> <td>'+Number.parseInt(-(data[totalTick-10][4]-close)*100/data[totalTick-10][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>1M</td> <td>'+Number.parseInt(-(data[totalTick-23][4]-close)*100/data[totalTick-23][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>6M</td> <td>'+Number.parseInt(-(data[totalTick-140][4]-close)*100/data[totalTick-140][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>1Y</td> <td>'+Number.parseInt(-(data[totalTick-269][4]-close)*100/data[totalTick-269][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>2Y</td> <td>'+Number.parseInt(-(data[totalTick-540][4]-close)*100/data[totalTick-540][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>3Y</td> <td>'+Number.parseInt(-(data[totalTick-807][4]-close)*100/data[totalTick-807][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>4Y</td> <td>'+Number.parseInt(-(data[totalTick-1076][4]-close)*100/data[totalTick-1076][4])+'</td> </tr>');
				$("#historyTable tbody").append('<tr> <td>5Y</td> <td>'+Number.parseInt(-(data[0][4]-close)*100/data[0][4])+'</td> </tr>');
			},
			error:function (data) {
				$("#historyTable tbody").empty();
			}
		});			
	}	
	
	
	
	
</script>



</html>